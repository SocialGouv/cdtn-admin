üóÉ hasura:
  extends:
    - .autodevops_register_image
    - .cdtn_base_rules
  variables:
    CONTEXT: ./targets/hasura
    IMAGE_NAME: $CI_REGISTRY_IMAGE/hasura

#
#
#

# todo: restrict to branches ?
‚è™ Restore data:
  extends:
    - .base_deploy_kosko_stage
    - .cdtn_base_rules
  stage: Deploy
  environment:
    name: ${AUTO_DEVOPS_PROD_ENVIRONMENT_NAME}
  needs:
    - job: üõÇ k8s test
  variables:
    KOSKO_GENERATE_ARGS: --env dev jobs/restore
  before_script:
    - "[[ -n $FORCE ]] && kubectl -n cdtn-admin-secret delete all -l component=${CI_COMMIT_REF_SLUG} || true"
    - kubectl -n cdtn-admin-secret get all -l component=${CI_COMMIT_REF_SLUG} && echo "Do not recreate jobs" && exit 0

#
#
#

üöß Cleanup db cronjob (prod):
  extends:
    - .base_deploy_kosko_stage
    - .cdtn_base_rules
  rules:
    - if: "$PRODUCTION && $CI_COMMIT_TAG"
      when: always
  environment:
    name: ${AUTO_DEVOPS_PROD_ENVIRONMENT_NAME}
  variables:
    KOSKO_GENERATE_ARGS: --env prod jobs/cleanup-db
