scripts:
  build:
    default: lerna run --stream build
    internals: lerna run --stream --scope shared* build
    targets: lerna run --stream --scope frontend --scope alert-cli build

  dev:
    default: concurrently --kill-others --kill-others-on-fail
      "lerna run --stream dev"
      "docker-compose up --build postgres hasura"
    frontend: yarn workspace frontend dev

  populate:
    default: docker-compose exec -T postgres psql -U postgres < ./targets/hasura/dev-theme-dump.sql

  dump:
    default: docker-compose exec postgres pg_dump --column-inserts --data-only postgres --schema public -t contents -t content_relations -t themes -t theme_relations -U postgres > ./targets/hasura/dev-theme-dump.sql

  e2e:
    default: lerna run --stream --parallel e2e

  lint:
    default: lerna run --stream --parallel lint

  test:
    default: lerna run --stream --parallel test

  pre-commit:
    default: lerna run --concurrency 1 --stream pre-commit --since HEAD --exclude-dependents

  pre-push:
    default: nps lint && nps test && nps e2e

  docker:
    up:
      default: docker-compose up --build postgres hasura
    stop: docker-compose stop
    rm: docker-compose rm -sfv && docker volume rm -f cdtn-admin_db_data
    purge: nps docker.stop && nps docker.rm
